# WordPress con Docker, Nginx y PostgreSQL

![WordPress](https://img.shields.io/badge/WordPress-6.4-blue.svg)
![PHP](https://img.shields.io/badge/PHP-8.3-purple.svg)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-green.svg)
![Nginx](https://img.shields.io/badge/Nginx-1.25-red.svg)
![Docker](https://img.shields.io/badge/Docker-Latest-blue.svg)

Configuraci√≥n profesional de WordPress optimizada para **servidores Linux y WSL** con las √∫ltimas versiones de todas las tecnolog√≠as.

## üöÄ Caracter√≠sticas

‚úÖ **WordPress 6.4** con PHP 8.3-FPM  
‚úÖ **PostgreSQL 16** como base de datos  
‚úÖ **Nginx 1.25** optimizado para alto rendimiento  
‚úÖ **Redis 7** para cache avanzado  
‚úÖ **Adminer** para gesti√≥n de base de datos  
‚úÖ **WP-CLI** para administraci√≥n por l√≠nea de comandos  
‚úÖ **Vol√∫menes bidireccionales** para desarrollo  
‚úÖ **Backup y restauraci√≥n autom√°tica**  
‚úÖ **Configuraci√≥n SSL/HTTPS** opcional  
‚úÖ **Optimizado para Linux/WSL** con permisos correctos  

## ‚ö° Instalaci√≥n de Un Solo Comando

```bash
# Clonar el repositorio
git clone https://github.com/ihmanox/wordpress-docker-compose-pro-lab.git
cd ihmanox/wordpress-docker-compose-pro-lab

# Ejecutar instalaci√≥n autom√°tica
chmod +x install.sh && ./install.sh
```

**¬°Eso es todo!** En menos de 5 minutos tendr√°s WordPress funcionando completamente.

## üìã Requisitos Previos

- **Docker** 20.10.13+ con Docker Compose
- **Usuario con permisos** de Docker (sin sudo)
- **Linux** o **WSL2** 
- **Puertos disponibles**: 8080, 8090 (configurables)

### Verificar Requisitos

```bash
# Verificar Docker
docker --version
docker compose version

# Verificar permisos (no debe requerir sudo)
docker ps

# Si necesitas permisos:
sudo usermod -aG docker $USER
newgrp docker
```

## ‚öôÔ∏è Configuraci√≥n

### Archivo .env (Pre-instalaci√≥n)

Antes de ejecutar `install.sh`, puedes personalizar estas configuraciones clave en `.env`:

```bash
# Credenciales de base de datos
POSTGRES_USER=tu_usuario
POSTGRES_PASSWORD=tu_password_seguro
POSTGRES_DB=tu_database

# Credenciales de WordPress
WP_ADMIN_USER=admin
WP_ADMIN_PASSWORD=password_admin_seguro
WP_ADMIN_EMAIL=admin@tusitio.com

# Puertos personalizados
WORDPRESS_PORT=8080      # Puerto para WordPress
ADMINER_PORT=8090        # Puerto para Adminer

# Configuraci√≥n del proyecto
COMPOSE_PROJECT_NAME=mi-wordpress
```

> **‚ö†Ô∏è IMPORTANTE**: Cambia todas las contrase√±as por defecto antes de la instalaci√≥n

### Configuraci√≥n Autom√°tica

El script `install.sh` configura autom√°ticamente:

- ‚úÖ **Permisos de usuario** (PUID/PGID)
- ‚úÖ **Verificaci√≥n de puertos**
- ‚úÖ **Estructura de directorios**
- ‚úÖ **Instalaci√≥n de WordPress**
- ‚úÖ **Configuraci√≥n de permalinks**
- ‚úÖ **Plugins de desarrollo**
- ‚úÖ **Cache Redis**

## üìÅ Estructura del Proyecto

```
proyecto/
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml     # Configuraci√≥n principal
‚îú‚îÄ‚îÄ üìÑ .env                   # Variables de entorno
‚îú‚îÄ‚îÄ üöÄ install.sh             # Instalador autom√°tico
‚îú‚îÄ‚îÄ üíæ backup.sh              # Backup autom√°tico
‚îú‚îÄ‚îÄ üîÑ restore.sh             # Restauraci√≥n autom√°tica
‚îú‚îÄ‚îÄ üîê generate-ssl.sh        # Certificados SSL
‚îú‚îÄ‚îÄ wordpress/                # üîÑ Desarrollo bidireccional
‚îÇ   ‚îú‚îÄ‚îÄ themes/              # Temas personalizados
‚îÇ   ‚îú‚îÄ‚îÄ plugins/             # Plugins personalizados
‚îÇ   ‚îú‚îÄ‚îÄ uploads/             # Archivos subidos
‚îÇ   ‚îî‚îÄ‚îÄ mu-plugins/          # Must-use plugins
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ nginx/               # Configuraci√≥n Nginx
‚îÇ   ‚îî‚îÄ‚îÄ php/                 # Configuraci√≥n PHP
‚îú‚îÄ‚îÄ backups/                 # Backups autom√°ticos
‚îú‚îÄ‚îÄ logs/                    # Logs de aplicaci√≥n
‚îî‚îÄ‚îÄ ssl/                     # Certificados SSL
```

## üéØ Acceso a Servicios

Una vez instalado:

| Servicio | URL | Credenciales |
|----------|-----|--------------|
| **WordPress** | http://localhost:8080 | Ver archivo `.env` |
| **Adminer** (DB) | http://localhost:8090 | PostgreSQL / Ver `.env` |
| **HTTPS** | https://localhost:8443 | Solo si SSL habilitado |

## üîß Comandos √ötiles

### Gesti√≥n del Proyecto

```bash
# Ver estado de servicios
docker compose ps

# Ver logs en tiempo real
docker compose logs -f

# Reiniciar Nginx
docker compose restart nginx

# Acceder via HTTPS
# https://localhost:8443 (aceptar certificado autofirmado)
```

### Para Producci√≥n con Let's Encrypt

```bash
# 1. Configurar dominio real en .env
WP_SITE_URL=https://tudominio.com

# 2. Instalar certbot en el servidor
sudo apt-get update
sudo apt-get install certbot python3-certbot-nginx

# 3. Obtener certificado SSL
sudo certbot --nginx -d tudominio.com

# 4. Renovaci√≥n autom√°tica
sudo crontab -e
# Agregar: 0 2 * * * /usr/bin/certbot renew --quiet --post-hook "docker compose restart nginx"
```

## üé® Desarrollo de Temas y Plugins

### Desarrollo de Temas

```bash
# Crear nuevo tema
mkdir wordpress/themes/mi-tema-custom
cd wordpress/themes/mi-tema-custom

# Crear style.css b√°sico
cat > style.css << EOF
/*
Theme Name: Mi Tema Custom
Description: Tema personalizado para mi sitio
Version: 1.0
Author: Tu Nombre
*/
EOF

# Crear index.php b√°sico
cat > index.php << EOF
<?php
get_header();
echo '<h1>Mi Tema Personalizado</h1>';
get_footer();
EOF

# El tema aparecer√° inmediatamente en WordPress Admin > Apariencia > Temas
```

### Desarrollo de Plugins

```bash
# Crear nuevo plugin
mkdir wordpress/plugins/mi-plugin-custom
cd wordpress/plugins/mi-plugin-custom

# Crear archivo principal del plugin
cat > mi-plugin-custom.php << EOF
<?php
/*
Plugin Name: Mi Plugin Custom
Description: Plugin personalizado para funcionalidades espec√≠ficas
Version: 1.0
Author: Tu Nombre
*/

// Prevenir acceso directo
if (!defined('ABSPATH')) {
    exit;
}

// Hook de activaci√≥n
register_activation_hook(__FILE__, 'mi_plugin_activar');

function mi_plugin_activar() {
    // C√≥digo de activaci√≥n
}

// Tu c√≥digo del plugin aqu√≠...
EOF

# El plugin aparecer√° inmediatamente en WordPress Admin > Plugins
```

### Hot Reload para Desarrollo

Los cambios en archivos se reflejan **inmediatamente** gracias a los vol√∫menes bidireccionales:

- ‚úÖ **Temas**: Cambios instant√°neos
- ‚úÖ **Plugins**: Cambios instant√°neos
- ‚úÖ **Uploads**: Archivos disponibles al momento
- ‚úÖ **Configuraci√≥n**: Reinicio r√°pido con `docker compose restart`

## üìä Monitoreo y Performance

### Logs y Debugging

```bash
# Ver todos los logs
docker compose logs -f

# Logs espec√≠ficos
docker compose logs -f nginx        # Logs de Nginx
docker compose logs -f wordpress    # Logs de WordPress/PHP
docker compose logs -f postgres     # Logs de PostgreSQL

# Logs de acceso de Nginx
tail -f logs/nginx/access.log

# Logs de error de Nginx
tail -f logs/nginx/error.log
```

### Monitoreo de Performance

```bash
# Estado de contenedores con uso de recursos
docker stats

# Informaci√≥n de PHP-FPM
curl http://localhost:8080/status

# Informaci√≥n de Redis
docker compose exec redis redis-cli info

# Informaci√≥n de PostgreSQL
docker compose exec postgres psql -U usuario -d database -c "SELECT version();"
```

### Optimizaci√≥n de Performance

El proyecto incluye optimizaciones autom√°ticas:

- ‚úÖ **PHP OPCache** habilitado
- ‚úÖ **Redis Cache** para objetos WordPress
- ‚úÖ **Nginx** con compresi√≥n Gzip
- ‚úÖ **Buffers** optimizados para archivos grandes
- ‚úÖ **Keep-alive** y conexiones persistentes
- ‚úÖ **Cache** de archivos est√°ticos con headers correctos

## üîß Soluci√≥n de Problemas Comunes

### Error de Permisos

```bash
# Reconfigurar permisos
sudo chown -R $USER:$USER wordpress/
find wordpress/ -type d -exec chmod 755 {} \;
find wordpress/ -type f -exec chmod 644 {} \;
chmod -R 777 wordpress/uploads
```

### Puerto en Uso

```bash
# Verificar qu√© usa el puerto
sudo netstat -tulnp | grep :8080
sudo ss -tulnp | grep :8080

# Cambiar puerto en .env
WORDPRESS_PORT=8081

# Reiniciar
docker compose down && docker compose up -d
```

### Problemas de Base de Datos

```bash
# Verificar conexi√≥n a PostgreSQL
docker compose exec postgres pg_isready -U usuario

# Reiniciar solo PostgreSQL
docker compose restart postgres

# Recrear base de datos
docker compose exec postgres dropdb -U usuario database_name
docker compose exec postgres createdb -U usuario database_name
```

### Problemas de Cache

```bash
# Limpiar cache de Redis
docker compose exec redis redis-cli FLUSHALL

# Limpiar cache de WordPress
docker compose exec wpcli wp cache flush

# Reiniciar servicios de cache
docker compose restart redis wordpress
```

### Problema de Memoria PHP

```bash
# Editar config/php/custom.ini
memory_limit = 1G

# Reiniciar WordPress
docker compose restart wordpress
```

## üîÑ Actualizaciones y Mantenimiento

### Actualizar WordPress

```bash
# Via WP-CLI (recomendado)
docker compose exec wpcli wp core update
docker compose exec wpcli wp core update-db

# Via Admin Panel
# WordPress Admin > Actualizaciones
```

### Actualizar Im√°genes Docker

```bash
# Actualizar todas las im√°genes
docker compose pull
docker compose up -d --build

# Actualizar imagen espec√≠fica
docker compose pull wordpress
docker compose up -d wordpress
```

### Limpieza del Sistema

```bash
# Limpiar im√°genes no utilizadas
docker system prune -f

# Limpiar vol√∫menes hu√©rfanos
docker volume prune -f

# Ver espacio utilizado
docker system df
```

## üöÄ Migraci√≥n a Producci√≥n

### Preparaci√≥n para Producci√≥n

1. **Configuraci√≥n de Seguridad**:

```bash
# En .env cambiar a producci√≥n
WP_DEBUG=false
PHP_DISPLAY_ERRORS=false

# Cambiar todas las contrase√±as
# Generar claves WordPress: https://api.wordpress.org/secret-key/1.1/salt/
```

2. **Configuraci√≥n de SSL**:

```bash
# Usar certificados reales de Let's Encrypt
# Ver secci√≥n SSL m√°s arriba
```

3. **Optimizaci√≥n**:

```bash
# Habilitar OPCache en producci√≥n
# Configurar backup autom√°tico
# Configurar monitoreo
```

### Migrar desde Desarrollo

```bash
# 1. Crear backup en desarrollo
./backup.sh

# 2. Transferir backup al servidor de producci√≥n
scp backups/wordpress_backup_*.tar.gz usuario@servidor:/ruta/proyecto/

# 3. En producci√≥n, restaurar
./restore.sh wordpress_backup_*.tar.gz
```

## ü§ù Contribuir

Si encuentras mejoras o bugs:

1. Fork del repositorio
2. Crear rama para tu feature: `git checkout -b nueva-feature`
3. Commit de cambios: `git commit -am 'Agregar nueva feature'`
4. Push a la rama: `git push origin nueva-feature`
5. Crear Pull Request

## üìù Changelog

### v2.0.0
- ‚úÖ Actualizado a WordPress 6.4 + PHP 8.3
- ‚úÖ PostgreSQL 16 Alpine
- ‚úÖ Nginx 1.25 con optimizaciones avanzadas
- ‚úÖ Script de instalaci√≥n de un solo comando
- ‚úÖ Backup/restore autom√°tico
- ‚úÖ Configuraci√≥n SSL integrada
- ‚úÖ WP-CLI incluido
- ‚úÖ Redis cache integrado

### v1.0.0
- ‚úÖ Configuraci√≥n inicial b√°sica

## üìÑ Licencia

Este proyecto est√° bajo la licencia MIT. Ver archivo `LICENSE` para m√°s detalles.

## üÜò Soporte

Si necesitas ayuda:

1. **Revisa la secci√≥n** de soluci√≥n de problemas
2. **Verifica los logs**: `docker compose logs -f`
3. **Crea un issue** en el repositorio con:
   - Versi√≥n de Docker
   - Sistema operativo
   - Logs relevantes
   - Pasos para reproducir el problema

## üåü Caracter√≠sticas Avanzadas

### Multi-Sitio WordPress

```bash
# Habilitar multisite
docker compose exec wpcli wp core multisite-convert

# Configurar subdominios o subdirectorios
# Ver documentaci√≥n oficial de WordPress Multisite
```

### Desarrollo con HTTPS Local

```bash
# Generar certificados para m√∫ltiples dominios
./generate-ssl.sh

# Agregar dominios al /etc/hosts
echo "127.0.0.1 local.miproyecto.dev" | sudo tee -a /etc/hosts
```

### Integraci√≥n con IDEs

El proyecto es compatible con:

- ‚úÖ **VS Code** con extensiones de PHP/WordPress
- ‚úÖ **PHPStorm** con configuraci√≥n Docker
- ‚úÖ **Vim/Neovim** con plugins de desarrollo web
- ‚úÖ **Sublime Text** con packages WordPress

---

## üéâ ¬°Listo para Desarrollar!

Con esta configuraci√≥n tienes un entorno de desarrollo WordPress profesional, escalable y listo para producci√≥n.

**¬°Disfruta desarrollando! üöÄ** servicios
docker compose restart

# Detener proyecto
docker compose down

# Actualizar im√°genes
docker compose pull && docker compose up -d --build
```

### WP-CLI (WordPress por l√≠nea de comandos)

```bash
# Informaci√≥n de WordPress
docker compose exec wpcli wp --info

# Actualizar WordPress
docker compose exec wpcli wp core update

# Instalar plugin
docker compose exec wpcli wp plugin install contact-form-7 --activate

# Cambiar URL del sitio
docker compose exec wpcli wp option update home 'https://mi-dominio.com'
docker compose exec wpcli wp option update siteurl 'https://mi-dominio.com'

# Crear usuario administrador
docker compose exec wpcli wp user create nuevo_admin admin@email.com --role=administrator

# Limpiar cache
docker compose exec wpcli wp cache flush
```

### Gesti√≥n de Base de Datos

```bash
# Backup manual de base de datos
docker compose exec postgres pg_dump -U usuario -d database > backup.sql

# Restaurar base de datos
docker compose exec -T postgres psql -U usuario -d database < backup.sql

# Conectar a PostgreSQL
docker compose exec postgres psql -U usuario -d database
```

## üíæ Backup y Restauraci√≥n

### Backup Autom√°tico

```bash
# Crear backup completo
./backup.sh

# Los backups se guardan en: backups/wordpress_backup_complete_FECHA.tar.gz
```

### Restauraci√≥n

```bash
# Restaurar backup completo
./restore.sh backups/wordpress_backup_complete_20241209_143022.tar.gz

# Opciones avanzadas
./restore.sh backup.tar.gz --db-only        # Solo base de datos
./restore.sh backup.tar.gz --files-only     # Solo archivos
./restore.sh backup.tar.gz --force          # Sin confirmaci√≥n
```

## üîê Configuraci√≥n SSL/HTTPS

### Para Desarrollo Local

```bash
# Generar certificados autofirmados
./generate-ssl.sh

# Habilitar SSL en Nginx
# Editar config/nginx/ssl.conf y descomentar configuraci√≥n

# Reiniciar# WordPress con Docker, Nginx y PostgreSQL

Esta configuraci√≥n te proporciona un entorno completo de WordPress con:

- **WordPress** con PHP 8.2-FPM
- **Nginx** como servidor web y proxy reverso
- **PostgreSQL** como base de datos
- **phpMyAdmin** y **Adminer** para gesti√≥n de base de datos
- **Vol√∫menes bidireccionales** para desarrollo
- **Configuraci√≥n personalizada** para subida de archivos grandes

## üöÄ Instalaci√≥n R√°pida

1. **Clona o descarga los archivos** en tu directorio de proyecto

2. **Ejecuta el script de instalaci√≥n:**
   ```bash
   chmod +x install.sh
   ./install.sh
   ```

3. **¬°Listo!** Accede a WordPress en `http://localhost:8080`

## üìÅ Estructura del Proyecto

```
proyecto/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ install.sh
‚îú‚îÄ‚îÄ wordpress/
‚îÇ   ‚îú‚îÄ‚îÄ themes/          # Temas personalizados
‚îÇ   ‚îú‚îÄ‚îÄ plugins/         # Plugins personalizados  
‚îÇ   ‚îú‚îÄ‚îÄ uploads/         # Archivos subidos
‚îÇ   ‚îî‚îÄ‚îÄ content/         # Contenido adicional
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ default.conf
‚îÇ   ‚îî‚îÄ‚îÄ php/
‚îÇ       ‚îî‚îÄ‚îÄ php.ini
‚îî‚îÄ‚îÄ logs/
```

## üîß Configuraci√≥n

### Variables de entorno (.env)

Edita el archivo `.env` para personalizar:

- **Puertos de acceso**
- **Credenciales de base de datos**
- **Configuraci√≥n de WordPress**

### Puertos por defecto

- **WordPress**: `http://localhost:8080`
- **phpMyAdmin**: `http://localhost:8081`
- **Adminer**: `http://localhost:8082`

## üé® Desarrollo de Temas y Plugins

### Temas
Coloca tus temas en `./wordpress/themes/` y aparecer√°n autom√°ticamente en WordPress.

### Plugins
Coloca tus plugins en `./wordpress/plugins/` y podr√°s activarlos desde el panel de administraci√≥n.

### Archivos subidos
Los archivos que subas desde WordPress se guardar√°n en `./wordpress/uploads/`

## üì§ Subida de Archivos Grandes

La configuraci√≥n permite subir archivos de hasta **100MB**:

- PHP: `upload_max_filesize = 100M`
- Nginx: `client_max_body_size 100M`

## üê≥ Comandos Docker √ötiles

```bash
# Iniciar servicios
docker-compose up -d

# Ver logs
docker-compose logs -f

# Ver logs de un servicio espec√≠fico
docker-compose logs -f wordpress

# Reiniciar servicios
docker-compose restart

# Detener servicios
docker-compose down

# Detener y eliminar vol√∫menes
docker-compose down -v

# Reconstruir contenedores
docker-compose up -d --build
```

## üóÑÔ∏è Gesti√≥n de Base de Datos

### Usando Adminer (Recomendado para PostgreSQL)
1. Accede a `http://localhost:8082`
2. Sistema: **PostgreSQL**
3. Servidor: **postgres**
4. Usuario: Seg√∫n tu `.env`
5. Contrase√±a: Seg√∫n tu `.env`
6. Base de datos: Seg√∫n tu `.env`

### Backup de Base de Datos
```bash
# Crear backup
docker-compose exec postgres pg_dump -U wordpress_user wordpress_db > backup.sql

# Restaurar backup
docker-compose exec -T postgres psql -U wordpress_user -d wordpress_db < backup.sql
```

## üõ†Ô∏è Soluci√≥n de Problemas

### Permisos de archivos
```bash
sudo chown -R $USER:$USER wordpress/
chmod -R 755 wordpress/
chmod -R 777 wordpress/uploads
```

### Reinstalar WordPress
```bash
docker-compose down -v
docker-compose up -d
```

### Ver logs de errores
```bash
# Logs de Nginx
docker-compose exec nginx cat /var/log/nginx/error.log

# Logs de WordPress
docker-compose logs wordpress
```

## üîí Seguridad

Para **producci√≥n**, aseg√∫rate de:

1. Cambiar todas las contrase√±as por defecto
2. Usar HTTPS con certificados SSL
3. Configurar un firewall
4. Actualizar regularmente los contenedores
5. Hacer backups regulares

## üìù Notas Importantes

- Los vol√∫menes son **bidireccionales**: los cambios se reflejan inmediatamente
- La configuraci√≥n est√° optimizada para **desarrollo local**
- PostgreSQL se usa como base de datos (m√°s robusta que MySQL)
- Nginx est√° configurado para **alto rendimiento**

## üÜò Soporte

Si encuentras problemas:

1. Verifica que Docker y Docker Compose est√©n instalados
2. Aseg√∫rate de que los puertos no est√©n en uso
3. Revisa los logs con `docker-compose logs`
4. Verifica los permisos de archivos

¬°Disfruta desarrollando con WordPress! üéâ
